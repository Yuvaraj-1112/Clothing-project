<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yuv clothing</title>
    <link rel="stylesheet" href="design/profile.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const userData = JSON.parse(localStorage.getItem("userProfile"));

            if (!userData) {
                window.location.href = "signpage.html";
                return;
            }

            // Fill text fields
            document.getElementById("profile-name").innerText = userData.name || "";
            document.getElementById("profile-mobile").innerText = userData.mobile || "";
            document.getElementById("profile-dob").innerText = userData.dob || "";
            document.getElementById("profile-gender").innerText = userData.gender || "";
            document.getElementById("profile-address").innerText = userData.address || "";
            document.getElementById("profile-location").innerText = userData.location || "";
            document.getElementById("profile-city").innerText = userData.city || "";
            document.getElementById("profile-pincode").innerText = userData.pincode || "";

            // Load Profile Picture for all img placeholders with class .profile-pic
            const profilePic = userData.profilePic || localStorage.getItem("profilePic") || "design/img/logo/profile-pic.webp";
            document.querySelectorAll(".profile-pic").forEach(img => {
                if (img) img.src = profilePic;
            });
        });

        function logout() {
            localStorage.removeItem("userProfile");
            window.location.href = "signpage.html";
        }

        function editProfile() {
            const userData = JSON.parse(localStorage.getItem("userProfile"));
            if (!userData) return;

            document.getElementById("edit-name").value = userData.name || "";
            document.getElementById("edit-mobile").value = userData.mobile || "";
            document.getElementById("edit-dob").value = userData.dob || "";
            document.getElementById("edit-gender").value = userData.gender || "";
            document.getElementById("edit-address").value = userData.address || "";
            document.getElementById("edit-location").value = userData.location || "";
            document.getElementById("edit-city").value = userData.city || "";
            document.getElementById("edit-pincode").value = userData.pincode || "";

            document.querySelector(".dashboard").style.display = "none";
            document.querySelector(".edit-dashboard").style.display = "block";
        }

        function saveProfile() {
            const updatedData = {
                name: document.getElementById("edit-name").value,
                mobile: document.getElementById("edit-mobile").value,
                dob: document.getElementById("edit-dob").value,
                gender: document.getElementById("edit-gender").value,
                address: document.getElementById("edit-address").value,
                location: document.getElementById("edit-location").value,
                city: document.getElementById("edit-city").value,
                pincode: document.getElementById("edit-pincode").value,
                profilePic: localStorage.getItem("profilePic") || "design/img/logo/profile-pic.webp"
            };

            localStorage.setItem("userProfile", JSON.stringify(updatedData));

            document.querySelector(".dashboard").style.display = "block";
            document.querySelector(".edit-dashboard").style.display = "none";

            // Update all visible profile pictures immediately
            const newPic = updatedData.profilePic;
            document.querySelectorAll(".profile-pic").forEach(img => { if (img) img.src = newPic; });

            // Update text content without a full reload
            document.getElementById("profile-name").innerText = updatedData.name;
            document.getElementById("profile-mobile").innerText = updatedData.mobile;
            document.getElementById("profile-dob").innerText = updatedData.dob;
            document.getElementById("profile-gender").innerText = updatedData.gender;
            document.getElementById("profile-address").innerText = updatedData.address;
            document.getElementById("profile-location").innerText = updatedData.location;
            document.getElementById("profile-city").innerText = updatedData.city;
            document.getElementById("profile-pincode").innerText = updatedData.pincode;
        }

        function previewImage(event) {
            const file = event.target.files && event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function () {
                // Update the preview element
                const profileImage = document.getElementById("edit-profile-pic");
                if (profileImage) profileImage.src = reader.result;
                // persist preview
                localStorage.setItem("profilePic", reader.result);
                // update all visible images immediately
                document.querySelectorAll(".profile-pic").forEach(img => { if (img) img.src = reader.result; });
            };
            reader.readAsDataURL(file);
        }

        function toggleSidebar() {
            document.getElementById("sidebar").classList.toggle("active");
            document.getElementById("overlay").classList.toggle("active");

            // Prevent body scroll when sidebar is open
            document.body.classList.toggle("no-scroll");
        }
    </script>
</head>
<body>

<!-- HEADER -->
<section id="header">
    <a href="#">
        <img src="design/img/logo/logoheader2.png" alt="website-logo">
    </a>

    <div>
        <ul id="navbar">
            <li><a href="homepage.html">Home</a></li>
            <li><a href="shoppage.html">Shop</a></li>
            <li><a href="offerpage.html">Offer</a></li>
            <li><a href="cartpage.html"><i class="fas fa-shopping-cart fa-lg"></i></a></li>
            <li class="separator"></li>
            <li class="active"><a href="profile.html"><i class="fas fa-user fa-lg"></i></a></li>
        </ul>
    </div>

    <div class="hamburger" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </div>
</section>

<div id="sidebar" class="sidebar">
    <div class="sidebar-header">
        <h3>Yuv Clothing</h3>
        <button class="close-btn" onclick="toggleSidebar()">&times;</button>
    </div>

    <ul class="sidebar-links">
        <li><a href="homepage.html">Home</a></li><hr>
        <li><a href="shoppage.html">Shop</a></li><hr>
        <li><a href="offerpage.html">Offers</a></li><hr>
        <li><a href="cartpage.html">Cart</a></li><hr>
        <li class="active"><a href="profile.html">Profile</a></li>
    </ul>
</div>
<div id="overlay" class="overlay" onclick="toggleSidebar()"></div>

<div class="profile-sidebar">
    <div id="pic-name">
        <!-- use class instead of duplicate id -->
        <img class="profile-pic" src="design/img/logo/profile-pic.webp" alt="profile picture">
    </div>
    <hr>
    <ul class="profile-sidelinks">
        <li id="active"><a href="profile.html"><i class="fa-regular fa-user"></i>Your profile</a></li><hr>
        <li id="edit-li"><button class="edit-btn" onclick="editProfile()"><i class="fa-regular fa-pen-to-square"></i>Edit Profile</button></li><hr>
        <li id="logout-li"><button class="logout-btn" onclick="logout()"><i class="fa-solid fa-right-from-bracket"></i>Logout</button></li><hr>
    </ul>
</div>

<div class="mobilebar">
    <div id="mobile-pic">
        <img class="profile-pic" src="design/img/logo/profile-pic.webp" alt="mobile profile pic">
    </div>
    <div id="edit-mob" class="mobile-pro-link">
        <button class="edit-btn" onclick="editProfile()"><i class="fa-regular fa-pen-to-square"></i>Edit Profile</button>
    </div>
    <div id="logout-mobile" class="mobile-pro-link">
        <button class="logout-btn" onclick="logout()"><i class="fa-solid fa-right-from-bracket"></i>Logout</button>
    </div>
</div>

<div class="dashboard-card">
    <div class="dashboard">
        <center><h1>Personal Details</h1></center>
        <div class="dash-divide">
            <div>
                <div class="dash-box">
                    <h2>Name</h2>
                    <span id="profile-name"></span>
                </div>

                <div class="dash-box">
                    <h2>Mobile Number</h2>
                    <span id="profile-mobile"></span>
                </div>

                <div class="dash-box">
                    <h2>Date of Birth</h2>
                    <span id="profile-dob"></span>
                </div>

                <div class="dash-box">
                    <h2>Gender</h2>
                    <span id="profile-gender"></span>
                </div>
            </div>

            <div>
                <div class="dash-box">
                    <h2>Address</h2>
                    <span id="profile-address"></span>
                    <span id="profile-location"></span>
                    <span id="profile-city"></span>
                    <span id="profile-pincode"></span>
                </div>
            </div>
        </div>
    </div>

    <div class="edit-dashboard" style="display: none;">
        <center><h1>Edit Profile</h1></center>
        <div class="dash-divide">
            <div>
                <div class="dash-box">
                    <h2>Name</h2>
                    <input type="text" id="edit-name" placeholder="Name">
                </div>

                <div class="dash-box">
                    <h2>Mobile Number</h2>
                    <input type="tel" id="edit-mobile" placeholder="Mobile">
                </div>

                <div class="dash-box">
                    <h2>Date of Birth</h2>
                    <input type="date" id="edit-dob">
                </div>

                <div class="dash-box">
                    <h2>Gender</h2>
                    <!-- make this an input so value can be saved -->
                    <select id="edit-gender">
                        <option value="">Select</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>

            <div>
                <div class="dash-box">
                    <h2>Address</h2>
                    <input type="text" id="edit-address" placeholder="Address">
                    <input type="text" id="edit-location" placeholder="Location">
                    <input type="text" id="edit-city" placeholder="City">
                    <input type="text" id="edit-pincode" placeholder="Pincode">
                </div>

                <div class="dash-box">
                    <h2>Profile Picture</h2>
                    <img id="edit-profile-pic" src="design/img/logo/profile-pic.webp" alt="preview" style="max-width:120px;display:block;margin-bottom:8px;">
                    <input type="file" accept="image/*" onchange="previewImage(event)">
                </div>

                <button id="save-btn" onclick="saveProfile()">Save</button>
            </div>
        </div>
    </div>
</div>

<!-- FOOTER -->
<footer>
    <hr>
    <div class="footer-container">
        <div class="footer-logo-section">
            <img src="design/img/logo/logofoot.png" alt="Yuv Clothing Logo">
            <div>
                <h3>Contact us</h3>
                <p><b>Address:</b> No:10, Thillai Nagar 11th cross, Thillai Nagar, Trichy</p>
                <p><b>E-mail:</b> yuvclothing@gmail.com</p>
                <p><b>Phone:</b> (+91) 63830 48080</p>
            </div>
        </div>

        <div class="footer-column">
            <h3>About</h3>
            <a href="#">About Us</a>
            <a href="#">Company Info</a>
            <a href="#">Carrier</a>
            <a href="#">Stories</a>
            <a href="#">Media</a>
            <a href="#">Corporate Info</a>
        </div>

        <div class="footer-column">
            <h3>Customer Policy</h3>
            <a href="#">Cancellations & Returns</a>
            <a href="#">Terms of use</a>
            <a href="#">Security</a>
            <a href="#">Privacy Policy</a>
            <a href="#">ERP Compliances</a>
            <a href="#">Terms & Conditions</a>
        </div>

        <div class="footer-social">
            <h3>Follow us</h3>
            <a href="https://facebook.com" id="facebook"><i class="fab fa-facebook fa-2x"></i></a>
            <a href="https://instagram.com" id="instagram"><i class="fab fa-instagram fa-2x"></i></a>
            <a href="https://x.com" id="x"><i class="fab fa-x-twitter fa-2x"></i></a>
            <a href="https://youtube.com" id="youtube"><i class="fab fa-youtube fa-2x"></i></a>
        </div>
    </div>
    <div class="footer-copy">
        <p>&copy; 2024 Yuv Clothing. All rights reserved.</p>
    </div>
</footer>

<!-- LAZY LOAD SCRIPT -->
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const images = document.querySelectorAll(".lazy-img");
        images.forEach(img => {
            img.addEventListener("load", () => {
                img.setAttribute("data-loaded", "true");
            });
        });
    });
</script>

</body>
</html>
